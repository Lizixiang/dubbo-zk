## 编译环境

JDK 1.8

RocketMQ 5.2.0

Springboot 2.4.3

## RocketMQ的pull和push

* 使用`@RocketMQMessageListener`注解默认使用push，具体实现为`DefaultMQPushConsumer`类
* 手动创建`DefaultLitePullConsumer`类来实现pull

## 消息重试

只有集群模式下使用push模式才提供消息重试机制

## 延迟消息

### 5.x之前

在RocketMQ 5.0之前，支持延迟时间：1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h

### 5.0及之后

在5.0之后支持自定义延迟时长

## 如何解决消息丢失？

### 在生产者发送消息给RocketMQ时，如果由于网络、代码、配置等原因导致发送消息失败，该如何处理？

* 无论是同步还是异步发送消息，一般建议在失败时重试发送，当重试达到指定次数时，抛出异常并上报结果

### 在多master多slave集群模式下，生产者发送消息给RocketMQ时，此时mq消息发送成功，但是在异步同步slave消息时mq挂了，该如何处理？

* 异步同步消息改为同步刷新，对接口的性能有一定影响
* 消息发送成功后，消息会被持久化到本地磁盘中，因此重启节点即可

### 当mq消息发送成功后，消费者挂了，该如何处理？

* 如果消费者是多个节点，那么单节点挂掉了，mq会重发该消息到其他节点上
* 如果所有节点都挂掉了，mq会在新节点加入进来时再次尝试发送改消息
* 当达到最大重试次数时，mq不再重试该消息，而是将该消息放入死信队列，一般这个时候需要定制代码，注册相应的topic来消费死信队列中的消息